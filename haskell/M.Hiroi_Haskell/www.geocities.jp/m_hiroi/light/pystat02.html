<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Algorithms with Python / 統計学の基礎知識</title>
  <meta name="description" content="Python,アルゴリズム,データ構造,入門">
  <link rel="stylesheet" type="text/css" href="../home_styles.css">
</head>
<body><!-- geoguide start --><div align=center><script language="javascript">var jps=382116062;var jpt=1550881799</script><script language="javascript" src="http://bc-geocities.yahoo.co.jp/js/gg.js"></script></div><!-- geoguide end -->
M.Hiroi's Home Page
<div class="small">
http://www.geocities.jp/m_hiroi/
</div>
<div class="ce">
<h1>Algorithms with Python</h1>
<h2>番外編：統計学の基礎知識 [2]</h2>
<div class="small">
[ <a href="pystat01.html">PrevPage</a> | <a href="index.html#python_algo_x">Python</a> | <a href="pystat03.html">NextPage</a> ]
<hr>
</div>
</div>
<section class="contents">
<h3>はじめに</h3>
<p> 今回は統計学の「検定」について説明します。統計学で言う検定とは、ある仮説にもとづいて実験または調査を行い、その結果からその仮説が正しいか否かを確率的に判定することです。「仮説検定」や「統計学的仮説検定」という場合もあります。文章で説明してもわかりにくいので、簡単な例を示しましょう。
</p>

<h4>●検定の基本的な考え方</h4>
<p> ある工場で直径 30 mm のガラス玉を製造していて、その品質を検査することを考えます。今までの経験上、このガラス玉の直径は平均 30 mm で標準偏差は 0.2 mm であることがわかっています。ある時間帯に作られたガラス玉の中から 30 個無作為抽出したところ、次に示すデータが得られました。なお、これらのデータは標準偏差も含めて仮想的なもので、現実のデータではありません。
</p>

<pre class="list">
リスト : ガラス玉の直径

data = [
  30.04, 30.01, 29.68, 29.84, 30.19, 29.93, 29.98, 29.95, 30.06, 30.27,
  30.14, 29.89, 29.93, 29.87, 30.10, 30.10, 30.04, 29.99, 29.79, 29.89,
  30.02, 29.98, 29.70, 29.71, 29.88, 30.12, 30.30, 29.70, 29.93, 29.81 
]
</pre>
<p> この標本平均を求めると 29.96 mm になりました。この時間帯に作られたガラス玉の直径は平均 30 mm を満たしているか検定してみましょう。この場合、仮説は「ガラス球の直径は平均 30 mm である」とします。
</p>
<p> 標本の大きさ n がある程度大きい場合、標本平均 m は正規分布に近似することができるので、その値は 30 ± 1.96 * √(0.2 * 0.2 / 30) =&gt; (29.928, 30.072) の範囲に 95 % の確率で入いります。逆にいえば、m が 29.928 よりも小さくなる、または 30.072 よりも大きくなる確率は 5 % しかありません。
</p>
<p> もしも、m &lt; 29.928 または 30.072 &gt; m であるならば、5 % の確率でしか起こらない事象が起きたことになります。この仮説のもとでこの事象が起こるのは不自然なことと考えられるので、前提となる仮説に誤りがあるのではないかと疑います。つまり、ガラス玉の直径は平均 30 mm ではなく、この時間帯に作られたガラス玉は基準を満たしていないと判定するわけです。
</p>

<p> 統計学では、前提となる仮説を「帰無仮説」と呼び、普通は H<sub>0</sub> と記述します。また、帰無仮説に対立する仮説を「対立仮説」と呼び、H<sub>1</sub> と記述します。帰無仮説を否定することを「棄却する」といい、帰無仮説を棄却したときに「検定の結果は有意である」といいます。
</p>

<p> 基準となる小さな確率αを「有意水準」または「危険率」といいます。また、帰無仮説を棄却する範囲を「危険率 100α % の棄却域」といいます。一般に、有意水準αには 0.05 または 0.01 が用いられます。危険率 5 % の棄却域は下図のようになります。
</p>

<p><img src="img/stat06.png" alt="棄却域 (両側)"> 棄却域 (赤色) の面積は 5 %
</p>

<p> 上図のように棄却域が左右の両側にある場合を「両側検定」といいます。検定する問題によって、左右どちらか一方に棄却域を設定する場合があります。これを「片側検定」といいます。片側検定の場合、危険率 5 % の棄却域は下図のようになります。
</p>

<p><img src="img/stat07.png" alt="棄却域 (右側)"> 棄却域 (赤色) の面積は 5 % (1.65 &lt; x)
</p>
<p><img src="img/stat08.png" alt="棄却域 (左側)"> 棄却域 (赤色) の面積は 5 % (x &lt; -1.65)
</p>

<p> 今回の例の場合、求めた平均値 29.96 mm は両側の棄却域に入らないので、帰無仮説は棄却されません。この場合、95 % の確率で起こるありふれた事象が起きたので、この時間帯のガラス玉の直径は平均 30 mm とみなしてもよいだろう、と判定します。
</p>

<p> ここで、仮説検定はあくまでも確率的に判断を下しているだけであり、絶対的なものではないということに注意してください。一般に、帰無仮説 H<sub>0</sub> が正しいのにそれを棄却する誤りを「第 1 種の誤り」といいます。第１種の誤りを犯す確率が危険率になります。また、H<sub>0</sub> が誤りなのにこれを容認する誤りを「第 2 種の誤り」といいます。帰無仮説を棄却するにしても容認するにしても、その判定が 100 % 正しいというわけではないのです。
</p>

<p> 仮説検定の手順をまとめると次のようになります。
</p>
<ol>
  <li>帰無仮説 (と対立仮説) を立てる。
  <li>有意水準αを定める。
  <li>帰無仮説の元で検定で用いる統計量を求める。
  <li>棄却域を定める。
  <li>統計量の実現値が棄却域に入るときは帰無仮説を棄却する。
</ol>

<p> 仮説検定の場合、棄却することを前提に帰無仮説を立てることが多くあります。たとえば、2 つの母集団の平均値 μ<sub>1</sub> と μ<sub>2</sub> に差があることを示したい場合、帰無仮説として "μ<sub>1</sub> = μ<sub>2</sub>" を立てます。この場合、対立仮説は "μ<sub>1</sub> != μ<sub>2</sub>" となります。そして、検定を行って帰無仮説を棄却することで、平均値に差があることを示すわけです。
</p>

<p> 仮説検定は、用いる統計量によって様々な方法があります。特に、カイ 2 乗分布 (χ<sup>2</sup> 分布) を利用したカイ 2 乗検定は、適合度の検定などによく用いられる方法です。
</p>

<h4>●適合度の検定</h4>
<p> 適合度の検定は、ある観測値 (実現値) が期待値 (理論値) と一致するかどうかを調べる方法です。たとえば、サイコロはどの目も等確率で出ることが期待されます。ここで帰無仮説「サイコロの出る目に偏りはない」を立てます。実際にサイコロを 600 回振って出た目を数えたところ、次のようになりました。
</p>
<table border=1>
<caption>表 A : サイコロの度数分布</caption>
<thead>
  <tr><th>目</th><th>観測度数</th><th>期待度数</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>89</td><td>100</td></tr>
  <tr><td>2</td><td>109</td><td>100</td></tr>
  <tr><td>3</td><td>91</td><td>100</td></tr>
  <tr><td>4</td><td>108</td><td>100</td></tr>
  <tr><td>5</td><td>99</td><td>100</td></tr>
  <tr><td>6</td><td>104</td><td>100</td></tr>
  <tr><td>合計</td><td>600</td><td>600</td></tr>
</tbody>
</table>

<p> サイコロが正常であるならば、各目の期待度数は 100 になります。次に、観測度数と期待度数の差を数値化します。単純に差分の合計値を求めると上手くいかないので、次の式で数値化します。
</p>
<pre class="fig">
       k
χ<sup>2</sup> = Σ (x<sub>i</sub> - m<sub>i</sub>)<sup>2</sup> / m<sub>i</sub>
      i=1

n : 回数, x<sub>i</sub> : 観測度数, m<sub>i</sub> : 期待度数, k : 階級数
</pre>
<p> この式の値 χ<sup>2</sup> は 0 以上の値をとり、観測度数と期待度数の差が少ないと小さな値に、差が多くなるほど大きな値になります。そして χ<sup>2</sup> の値は、自由度 k - 1 のカイ 2 乗分布に近似できることが知られています。自由度をνとすると、カイ 2 乗分布の密度関数は次式のようになります。
</p>
<pre class="fig">
f(x) = x<sup>ν/2 - 1</sup> * exp(- x/2) / (2<sup>ν/2</sup> * Γ(ν/2))

               ∞
ここで Γ(x) = ∫ exp(-t) * t<sup>x-1</sup> dt (ガンマ関数)
               0
</pre>
<p> 図に示すと次のようになります。
</p>
<p><img src="img/stat09.png" alt="カイ 2 乗分布"> 自由度 2 - 黒, 3 - 青, 4 - 緑, 5 - 赤
</p>
<p> サイコロの度数分布表からχ<sup>2</sup>値を求めると、次のようになります。
</p>
<pre class="fig">
χ<sup>2</sup> = (89 - 100)<sup>2</sup>/100 + (109 - 100)<sup>2</sup>/100 + (91 - 100)<sup>2</sup>/100 +

      (108 - 100)<sup>2</sup>/100 + (99 - 100)<sup>2</sup>/100 + (104 - 100)<sup>2</sup>/100

    = 3.64
</pre>
<p> 次に有意水準αの値を 0.05 に設定します。適合度を検定するので、この場合は棄却域を右側に設定します。<a href="pystat02.html#cite">参考文献 1, 2</a> にあるカイ 2 乗分布表から自由度 5 危険率 5 % の棄却域を求めると (11.07, ∞) になります。今回のχ<sup>2</sup>値は 3.64 なので棄却域には入りません。したがって、帰無仮説「サイコロの出る目に偏りはない」を容認します。もしも、χ<sup>2</sup>値が 11.07 以上であれば帰無仮説を棄却して、このサイコロは出る目に偏りがあるという結論になります。
</p>

<p> この例のように、期待度数が一定の場合を特に「一様性の検定」といいます。なお、期待度数が一定ではない場合でも、カイ 2 乗検定を行うことができます。たとえば、サイコロを 3 回振って出た目の和を求めることにしましょう。とりうる値は 3 から 18 まであり、サイコロの出る目が等確率の場合、その確率分布は次のようになります。
</p>

<table border=1>
<caption>表 B : 確率分布</caption>
<thead>
  <tr><th>値</th><th>確率</th><th>値</th><th>確率</th></tr>
</thead>
<tbody>
  <tr><td>3</td><td>1/216</td><td>11</td><td>27/216</td></tr>
  <tr><td>4</td><td>3/216</td><td>12</td><td>25/216</td></tr>
  <tr><td>5</td><td>6/216</td><td>13</td><td>21/216</td></tr>
  <tr><td>6</td><td>10/216</td><td>14</td><td>15/216</td></tr>
  <tr><td>7</td><td>15/216</td><td>15</td><td>10/216</td></tr>
  <tr><td>8</td><td>21/216</td><td>16</td><td>6/216</td></tr>
  <tr><td>9</td><td>25/216</td><td>17</td><td>3/216</td></tr>
  <tr><td>10</td><td>27/216</td><td>18</td><td>1/216</td></tr>
</tbody>
</table>

<p> 実際に 600 回の試行を行った結果、観測度数は次のようになりました。
</p>

<table border=1>
<caption>表 C : 度数分布</caption>
<theead>
  <tr><th>値</th><th>観測度数</th><th>期待度数</th><th>値</th><th>観測度数</th><th>期待度数</th></tr>
</thead>
<tbody>
  <tr><td>3</td><td>4</td><td>2.78</td><td>11</td><td>74</td><td>75.00</td></tr>
  <tr><td>4</td><td>7</td><td>8.33</td><td>12</td><td>71</td><td>69.44</td></tr>
  <tr><td>5</td><td>12</td><td>16.67</td><td>13</td><td>62</td><td>58.33</td></tr>
  <tr><td>6</td><td>32</td><td>27.78</td><td>14</td><td>32</td><td>41.67</td></tr>
  <tr><td>7</td><td>41</td><td>41.67</td><td>15</td><td>40</td><td>27.78</td></tr>
  <tr><td>8</td><td>55</td><td>58.33</td><td>16</td><td>17</td><td>16.67</td></tr>
  <tr><td>9</td><td>71</td><td>69.44</td><td>17</td><td>12</td><td>8.33</td></tr>
  <tr><td>10</td><td>68</td><td>75.00</td><td>18</td><td>2</td><td>2.78</td></tr>
  <tr><td></td><td></td><td></td><td>合計</td><td>600</td><td>600</td></tr>
</tbody>
</table>

<p> この結果が表 B の確率分布と一致するかカイ 2 乗検定を行います。帰無仮説は「表 B の確率分布と一致する」とします。差が大きい場合、χ<sup>2</sup> 値は大きくなるので棄却域は右側だけの片側検定になります。表 B のχ<sup>2</sup> 値を計算すると 13.32 になりました。
</p>
<p> 自由度 16 - 1 = 15 のカイ 2 乗分布で危険率 5 % の棄却率を求めると (25.0, ∞) になります。13.32 &lt; 25.0 なので棄却域には入りません。したがって、帰無仮説は容認されて、表 C の結果は表 B の確率分布に一致するという結論になります。もしも、χ<sup>2</sup>値が 25.0 よりも大きい場合は帰無仮説を棄却して、表 B の確率分布とは一致しないという結論になります。
</p>

<h4>●独立性の検定</h4>
<p> カイ 2 乗検定は適合度の検定だけではなく「独立性」の検定にも用いることができます。独立性とは 2 つの確率変数の間に関連性がないことをいいます。カイ 2 乗検定の場合、相関性を示すために独立性の検定を行うことがよくあります。たとえば、確率変数 X と Y に関連性がないという帰無仮説を立てます。次に、カイ 2 乗検定を行って、それが棄却されれば、X と Y に関連性があるという結論になります。
</p>

<p> 独立性の検定には「分割表」を使います。確率変数 X の値が m 個、確率変数 Y の値が n 個ある場合、分割表は m 行 n 列の大きさになります。i 行 j 列の要素を z<sub>ij</sub> とすると、χ<sup>2</sup>値は次のように計算されます。
</p>
<pre class="fig">
       m   n
χ<sup>2</sup> = Σ  Σ (z<sub>ij</sub> - F<sub>ij</sub>)<sup>2</sup>/F<sub>ij</sub>
      i=1 j=1

F<sub>ij</sub> = z<sub>*j</sub> * z<sub>i*</sub> / total

       m             n
z<sub>*j</sub> = Σ z<sub>ij</sub>,  z<sub>i*</sub> = Σ z<sub>ij</sub>
      i=1           j=1

         n   m
total = Σ  Σ z<sub>ij</sub>
        i=1 j=1
</pre>
<p> ポイントは各要素の期待度数 F<sub>ij</sub> の計算方法です。i 行の合計値を z<sub>i*</sub> とし、j 列の合計値を z<sub>*j</sub> とします。全要素の合計値を total とすると、期待度数は j 列の合計値を各行の割合で振り分ける、または i 行の合計値を各列の割合で振り分けることで求めることができます。どちらの場合でも期待度数は "j 列 の合計値 * i 行の合計値 / total" になります。この場合、χ<sup>2</sup>値は自由度 (n - 1) * (m - 1) のカイ 2 乗分布に従うことが知られています。
</p>

<p> たとえば、サイコロを 2 回振った場合、最初に出る目 X と次の目 Y に相関性はないはずです。これをカイ 2 乗検定で確かめてみましょう。帰無仮説は「X と Y に相関性はない」となります。実際に、この試行を 720 回行ったところ結果は次のようになりました。
</p>
<pre class="fig">
                分割表

               Ｙ
     | １  ２  ３  ４  ５  ６ | 計
   --+------------------------+----
   １| 16  21  19  21  20  24 | 121
   ２| 19  15  17  13  24  24 | 112
Ｘ ３| 21  14  20  22  22  18 | 117
   ４| 18  20  23  18  16  24 | 119
   ５| 14  17  20  19  24  22 | 116
   ６| 21  21  24  26  23  20 | 135
   ---------------------------+----
   計|109 108 123 119 129 132 | 720
</pre>
<p> たとえば、z<sub>11</sub> の期待度数は 121 * 109 / 720 = 18.32 になります。分割表が大きくなると手で計算するのは大変なのでプログラムを作りましょう。次のリストを見てください。
</p>
<pre class="list">
リスト :  分割表のカイ 2 乗値を求める

def chi2(count):
    total = 0.0
    xn = len(count)
    yn = len(count[0])
    xcount = [0] * xn
    ycount = [0] * yn
    for x in xrange(xn):
        for y in xrange(yn):
            a = count[x][y]
            total += a
            xcount[x] += a
            ycount[y] += a
    #
    v = 0.0
    for x in xrange(xn):
        for y in xrange(yn):
            F = xcount[x] * ycount[y] / total
            a = count[x][y] - F
            v += a * a / F
    return v
</pre>
<p> 関数 chi2 の引数 count が分割表で 2 次元配列を渡します。行の個数を xn に、列の個数を yn にセットします。そして、行の合計値を xcount に、列の合計値を ycount に、要素の合計値を total に集計します。あとは、χ<sup>2</sup>値を計算するだけです。
</p>

<p> 実際に計算すると、χ<sup>2</sup>値は 12.396 になりました。自由度 5 * 5 = 25 のカイ 2 乗分布で危険率 5 % の棄却域は (37.7, ∞) になります。今回は棄却域に入っていないので帰無仮説を容認する、つまり X と Y に相関性はないという結論になります。もしも、χ<sup>2</sup>値が 37.7 よりも大きい場合は帰無仮説を棄却して、X と Y に相関性があるという結論になります。
</p>

<p> もう一つ、簡単な例を示しましょう。カイ 2 乗検定では 2 行 2 列の分割表もよく用いられます。たとえば、ある飲料 A の好き嫌いを男性 80 人と女性 120 人に調査したところ、次のような結果になりました。
</p>
<pre class="fig">
        分割表

    | 好き 嫌い | 計
----+-----------+-----
男性|  35   45  |  80
女性|  80   40  | 120
----+-----------+-----
 計 | 115   85  | 200
</pre>
<p> 男女で好みに差があるか検定してみましょう。この場合、帰無仮説は「男女で好みに差は無い」となります。実際に計算すると、χ<sup>2</sup>値は 10.315 になりました。自由度 (2 - 1) * (2 - 1) = 1 のカイ 2 乗分布で危険率 5 % の棄却域は (3.84, ∞) になります。この場合、χ<sup>2</sup>値は棄却域に入っているので帰無仮説を棄却して、飲料 A は男女で好みに差があるという結論になります。もしも、男性の好き嫌いが 45, 35 だったとすると、χ<sup>2</sup>値は 2.222 となり、帰無仮説を容認することになります。
</p>

<p> カイ 2 乗検定を行う場合、観測度数が少ないとカイ 2 乗分布の近似度が悪くなるので注意が必要です。2 行 2 列の分割表で観測度数が 10 以下のもの (5 以下とする説もある) がある場合、「イェツ (Yates) の修正」という方法を使います。このページでは説明を割愛いたしますので、詳しくは <a href="pystat02.html#cite">参考文献 1</a> をお読みください。
</p>

<h4>●母集団の平均値の検定</h4>
<p> 母集団が正規分布 N(μ, σ<sup>2</sup>) に従うことが分かっている場合、母平均μを検定することは簡単です。標本の大きさが n の場合、標本平均 m は正規分布 N(μ, σ<sup>2</sup>/n) に近似されます。したがって、次に示す統計量 Z は標準正規分布 N(0, 1) に従うので、簡単に検定することができます。
</p>
<pre class="fig">
Z = (m - μ) / √(σ<sup>2</sup>/n) ～ N(0, 1)

危険率 5 % の棄却域

両側検定 : (-∞, -1.96), (1.96, ∞)

左側検定 : (-∞, -1.65)

右側検定 : (1.65, ∞)
</pre>

<p> 簡単な例を示しましょう。ある工場で生産している電球の寿命は正規分布に従っていて、平均寿命は 1800 時間で標準偏差が 180 時間であることが分かっています。ここで、30 個の電球を無作為抽出して寿命を計測したところ次のデータを得ました。なお、これらのデータは、平均寿命と標準偏差も含めて仮想的なもので、現実のデータでありません。
</p>

<pre class="list">
リスト : 電球の寿命

data = [
    1834, 1804, 1509, 1652, 1971, 1739, 1785, 1754, 
    1855, 2041, 1927, 1696, 1734, 1679, 1890, 1889, 
    1834, 1790, 1611, 1699, 1815, 1780, 1526, 1537, 
    1692, 1910, 2073, 1529, 1732, 1630, 
]
</pre>
<p> この電球の平均寿命は 1800 時間であることを認めてよいか、消費者の立場で検定してみましょう。帰無仮説は「電球の平均寿命は 1800 時間である」になります。この場合、平均寿命は 1800 時間よりも長くてかまわないので、1800 時間よりも短いかどうかが問題になります。したがって、対立仮説は「電球の平均寿命は 1800 時間よりも短い」となり、棄却域は片側 (左側) に設定します。data の平均値を求めると 1763.9 時間になるので、統計量 Z を計算すると次のようになります。
</p>
<pre class="fig">
Z = (1763.9 - 1800) / (180 / sqrt(30)) = -1.098
</pre>
<p> 危険率 5 % の棄却率は (-∞, -1.65) なので、Z は棄却域に入りません。したがって、帰無仮説は棄却されず「電球の平均寿命は 1800 時間である」ことを容認します。
</p>

<p> もしも、計測結果が次に示すデータだったとしましょう。
</p>
<pre class="list">
リスト : 電球の寿命

data1 = [
    1784, 1754, 1459, 1602, 1921, 1689, 1735, 1704, 
    1805, 1991, 1877, 1646, 1684, 1629, 1840, 1839, 
    1784, 1740, 1561, 1649, 1765, 1730, 1476, 1487, 
    1642, 1860, 2023, 1479, 1682, 1580, 
]
</pre>
<p> data1 の場合、平均寿命は 1713.9 時間になります。統計量 Z を計算すると -2.620 になり、危険率 5 % の棄却域に入ります。よって、帰無仮説を棄却して「電球の平均寿命は 1800 時間よりも短い」となります。
</p>

<p> 母集団が正規分布していない場合でも、n を大きくすると中心極限定理により標本平均 m は正規分布で近似することができます。たとえば、実数の区間 [0, 1.0) の一様乱数は、平均 1/2 分散 1/12 になります。n 個の乱数の平均値は 1/2 で分散 1/12n になるので、統計量 Z = (m - 1/2)/√(1/12n) は N(0, 1) に従います。これを使って乱数の簡単な検定を行うことができます。 次のリストを見てください。
</p>

<pre class="list">
リスト : 擬似乱数の簡単な検定

import math, rand

def test(prg, n):
    m = 0.0
    for _ in xrange(n):
        m += prg.random()
    m /= n
    z = (m - 0.5) / math.sqrt(1.0 / (12 * n))
    return -1.96 &lt: z &lt; 1.96


prg = rand.Random(1)
for _ in xrange(20):
    print test(prg, 10000)
</pre>
<p> モジュール rand は拙作のページ <a href="pyalgo18.html">擬似乱数</a> で作成したもので、線形合同法で乱数を生成します。プログラムは簡単なので説明は不要だと思います。今回は危険率 5 % で判定しているので、テストを 20 回行えば 1 回くらいは棄却されることになります。テスト回数をもっと増やすと、棄却される割合は 5 % に近い値になります。そうでなければ、擬似乱数として何か問題があると考えられます。テスト結果は、True が 19 回で False が 1 回になりました。
</p>

<p> このテストは簡単なので、ほとんどの乱数生成アルゴリズムはこれをクリアすると思います。擬似乱数の検定はけっこう難しくて、この検定をクリアしたからといって一様性が保障されるわけではありません。複数の検定を試してみる必要があります。擬似乱数の検定にはいろいろな方法が考案されていて、一様性の検定にはカイ 2 乗検定を用いることができます。興味のある方は <a href="pystat02.html#cite">参考文献 2</a> をお読みください。
</p>
<h4>●分散が未知の場合</h4>
<p> 母集団が正規分布に従っていて分散が未知の場合は、標本の不偏分散 U<sup>2</sup> で代用して t 分布を使って検定します。t 分布を用いた検定を「t 検定」といいます。次に示す統計量 T は自由度 n - 1 の t 分布 t(n - 1) に従います。
</p>
<pre class="fig">
T = (m - μ) /√(U<sup>2</sup>/n) ～ t(n - 1)
</pre>
<p> たとえば、最初に例題として取り上げたガラス玉で、直径は正規分布に従っているが分散は未知だったとしましょう。この場合、平均は 29.96 mm で不偏分散が 0.0263 になり、統計量 T の値を計算すると -1.351 になります。自由度 29 の t 分布で危険率 5 % の棄却域は両側検定で (-∞, -2.05), (2.05, ∞) になります。T は棄却域に入っていないので、帰無仮説は棄却されません。
</p>

<p> 電球の寿命の場合、data では平均寿命 1763.9 時間で不偏分散は 21528.92 になります。統計量 T の値を計算すると -1.348 になり、自由度 29 の t 分布で危険率 5 % 左側の棄却域 (-∞, -1.70) に入りません。したがって、帰無仮説は棄却されずに容認されます。
</p>

<p> data1 の場合は、平均寿命 1713.9 時間で不偏分散は 21528.92 になります。統計量 T の値は -3.214 になり、危険率 5 % の棄却域 (-∞, -1.70) に入ります。この場合は帰無仮説を棄却して「電球の平均寿命は 1800 時間よりも短い」となります。
</p>
<h4>●平均値の差の検定</h4>
<p> 2 つの母集団 A, B があり、それぞれ正規分布 N(μ<sub>a</sub>, σ<sub>a</sub><sup>2</sup>), N(μ<sub>b</sub>, σ<sub>b</sub><sup>2</sup>) に従うとします。このとき、μ<sub>a</sub> - μ<sub>b</sub> を検定することを考えます。帰無仮説は平均値に差がないこと、つまり μ<sub>a</sub> = μ<sub>b</sub> になります。帰無仮説が棄却されると、2 つの母集団の平均値に差があることになります。
</p>

<p> 分散が既知の場合、正規分布の加法性から 2 つの標本平均の差 m<sub>a</sub> - m<sub>b</sub> が次の正規分布に従うことを用いて検定します。
</p>
<pre class="fig">
m<sub>a</sub> - m<sub>b</sub> は N(μ<sub>a</sub>-μ<sub>b</sub>, σ<sub>a</sub><sup>2</sup>/n + σ<sub>b</sub><sup>2</sup>/n) に従う

Z = ((m<sub>a</sub> - m<sub>b</sub>) - (μ<sub>a</sub> - μ<sub>b</sub>)) / √(σ<sub>a</sub><sup>2</sup>/n + σ<sub>b</sub><sup>2</sup>/n)

ここで μ<sub>a</sub> = μ<sub>b</sub> とすると

Z = (m<sub>a</sub> - m<sub>b</sub>) / √(σ<sub>a</sub><sup>2</sup>/n + σ<sub>b</sub><sup>2</sup>/n) ～ N(0, 1)
</pre>
<p> 簡単な例を示しましょう。ある地域 A, B で同じ学年の生徒を無作為抽出して身長を計測したところ、次のデータを得ました。なお、これらのデータは仮想的なもので、現実のデータではありません。
</p>
<pre class="list">
リスト : 身長のデータ

data_a = [
    151.0, 154.6, 160.5, 147.1, 151.2, 144.4, 157.2, 157.8, 
    150.8, 153.1, 146.2, 155.9, 156.6, 151.3, 144.9, 156.7, 
    145.7, 149.0, 141.7, 148.2, 148.0, 149.8, 144.3, 159.0, 
    151.3, 134.7, 157.7, 157.1, 135.7, 156.9 
]

data_b = [
    160.5, 150.5, 158.6, 149.2, 150.0, 154.4, 147.9, 143.4, 
    155.9, 138.2, 162.3, 155.4, 158.6, 152.2, 154.4, 149.7, 
    145.4, 146.4, 156.6, 153.1, 162.8, 151.4, 146.7, 156.8, 
    143.9, 157.0, 139.3, 147.2, 149.8, 154.7 
]
</pre>
<p> 地域 A の平均身長は 150.61 cm で地域 B の平均身長は 151.74 cm になりました。今までの経験上、分散は両地域とも 36.0 であることが分かっています。2 つの地域で平均身長に差があるか検定してみましょう。帰無仮説は「平均身長に差は無い」となります。統計量 Z を計算すると次のようになります。
</p>
<pre class="fig">
Z = (150.61 - 151.74) / sqrt(36.0/30 + 36.0/30) = -0.729
</pre>
<p> 危険率 5 % の棄却域は両側検定で (-∞, -1.96), (1.96, ∞) になります。Z は棄却域に入らないので帰無仮説を容認します。つまり、2 つの地域の平均身長に差はないという結論になります。
</p>
<p> もしも、地域 B の標本が次に示すデータだとしましょう。
</p>
<pre class="list">
リスト : 地域 B の身長データ

data_b1 = [
    163.5, 153.5, 161.6, 161.4, 159.8, 152.2, 153.0, 157.4, 
    150.9, 146.4, 158.9, 144.3, 141.2, 165.3, 158.4, 161.6, 
    161.5, 159.1, 155.2, 146.3, 157.4, 153.4, 152.7, 148.4, 
    149.4, 159.6, 156.1, 156.3, 148.4, 165.8, 154.4, 148.5, 
    149.7, 159.8, 146.9, 160.0, 142.3, 150.2, 152.8, 157.7
]
</pre>
<p> 標本の大きさが 40 で平均身長は 154.53 cm になります。地域 A と平均身長に差があるか検定すると、次のようになります。
</p>
<pre class="fig">
Z = (150.61 - 154.53) / sqrt(36.0/30 + 36.0/40) = -2.705
</pre>
<p> この場合、統計量 Z の値は棄却域に入るので帰無仮説を棄却して、平均身長に差があるという結論になります。
</p>

<h4>●分散が未知の場合</h4>
<p> 分散は分からないが同じ値とみなせる場合、標本の不偏分散で代用して t 分布で検定します。標本の大きさを n<sub>a</sub> n<sub>b</sub> 標本平均を m<sub>a</sub> m<sub>b</sub> 不偏分散を U<sub>a</sub> U<sub>b</sub> とすると、次の式で分散σと統計量 T を計算します。
</p>
<pre class="fig">
σ = ((n<sub>a</sub> - 1)U<sub>a</sub> + (n<sub>b</sub> - 1)U<sub>b</sub>) / (n<sub>a</sub> + n<sub>b</sub> - 2)

T = (m<sub>a</sub> - m<sub>b</sub>) / √(σ/n<sub>a</sub> + σ/n<sub>b</sub>) ～ t(n<sub>a</sub>+n<sub>b</sub>-2)
</pre>
<p> 統計量 T は自由度 n<sub>a</sub> + n<sub>b</sub> - 2 の t 分布に従います。簡単な例として、平均身長の例題で分散の値が未知の場合を考えてみましょう。data_a の平均値は 150.61 cm 不偏分散 43.46 で、data_b の平均値は 151.74 cm 不偏分散 39.82 になります。統計量 T を計算すると次のようになります。
</p>
<pre class="fig">
σ = ((30 - 1) * 43.46 + (30 - 1) * 39.82) / (30 + 30 - 2) = 41.64

T = (150.61 - 151.74) / sqrt(41.64 / 30 + 41.64 / 30) = -0.678
</pre>
<p> <a href="pystat02.html#cite">参考文献 1</a> の t 分布表に自由度 58 の値は掲載されていないので、自由度 60 で代用します。危険度 5 % の棄却域は両側検定で (-∞, -2.00), (2.00, ∞) になるので、T は棄却域に入りません。よって、帰無仮説を容認して「平均値に差は無い」が結論になります。
</p>

<p> data_b1 の場合、平均 154.53 cm 不偏分散 39.78 になります。統計量 T を計算すると次のようになります。
</p>
<pre class="fig">
σ = ((30 - 1)*43.46 + (40 - 1)*39.78) / (30 + 40 - 2) = 41.35

T = (150.61 - 154.53) / sqrt(43.46/30 + 41.35/40) = -2.488
</pre>
<p> 自由度 60 で代用すると、T の値は棄却域 (-∞, -2.00) に入るので、帰無仮説を棄却して「平均値に差がある」が結論になります。
</p>

<h4>●対をなすデータの差の検定</h4>
<p> 今までは 2 つの母集団の平均値を比較しましたが、1 つの母集団の中で 2 つのデータに差があるか比較したい場合があります。たとえば、無作為抽出した 30 人に飲料 A と飲料 B を飲み比べてもらい、点数をつけてもらいました。その結果、次のようなデータを得ました。
</p>
<table border=1>
<caption>A と B の点数</caption>
<thead>
  <tr><th>A</th><th>B</th><th>d</th><th>A</th><th>B</th><th>d</th></tr>
</thead>
<tbody>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>8 </td><td>8 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>8 </td><td>8 </td><td>0 </td></tr>
  <tr><td>4 </td><td>2 </td><td>2 </td><td>6 </td><td>5 </td><td>1 </td></tr>
  <tr><td>8 </td><td>9 </td><td>-1 </td><td>5 </td><td>4 </td><td>1 </td></tr>
  <tr><td>6 </td><td>7 </td><td>-1 </td><td>6 </td><td>7 </td><td>-1 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>6 </td><td>7 </td><td>-1 </td></tr>
  <tr><td>9 </td><td>8 </td><td>1 </td><td>6 </td><td>7 </td><td>-1 </td></tr>
  <tr><td>6 </td><td>7 </td><td>-1 </td><td>6 </td><td>6 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>4 </td><td>4 </td><td>0 </td></tr>
  <tr><td>3 </td><td>4 </td><td>-1 </td><td>7 </td><td>7 </td><td>0 </td></tr>
  <tr><td>3 </td><td>5 </td><td>-2 </td><td>8 </td><td>8 </td><td>0 </td></tr>
  <tr><td>6 </td><td>7 </td><td>-1 </td><td>6 </td><td>6 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>3 </td><td>4 </td><td>-1 </td></tr>
  <tr><td>8 </td><td>8 </td><td>0 </td><td>7 </td><td>7 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>8 </td><td>6 </td><td>2 </td></tr>
</tbody>
</table>
<p> A の平均値は 6.10 で B の平均値は 6.23 になりました。ここで、A と B の平均値に差があるか検定することを考えます。この場合、A と B の差分 d を求め、その平均値と不偏分散から統計量 T を計算します。T は自由度 n - 1 の t 分布に従うので、これを用いて検定することができます。この方法を「対応のある t 検定」といいます。帰無仮説は「A と B の平均値に差はない」となります。統計量 T の計算式を示します。
</p>
<pre class="fig">
T = m / √(U<sup>2</sup> / n) ～ t(n-1)
</pre>
<p> 不偏分散の代わりに標本分散 S<sup>2</sup> を使うこともできます。その場合は次の式になります。
</p>
<pre class="fig">
T = m / √(S<sup>2</sup> / (n-1)) ～ t(n-1)
</pre>
<p> 標本分散 S<sup>2</sup> を n - 1 で割ることに注意してください。
</p>
<p> 実際に計算すると、d の平均値は -0.13 不偏分散 0.81 になるので、統計量 T の値は次のようになります。
</p>
<pre class="fig">
T = -0.13 / sqrt(0.81/30) = -0.791
</pre>
<p> T の値は自由度 29 の t 分布で危険率 5 % の棄却域 (-∞, -2.05), (2.05, ∞) に入りません。したがって、帰無仮説を容認します。
</p>

<p> もしも、A と B の点数が次に示すデータだったとしましょう。
</p>
<table border=1>
<caption>A と B の点数</caption>
<thead>
  <tr><th>A</th><th>B</th><th>d</th><th>A</th><th>B</th><th>d</th></tr>
</thead>
<tbody>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>8 </td><td>8 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>8 </td><td>8 </td><td>0 </td></tr>
  <tr><td>4 </td><td>2 </td><td>2 </td><td>6 </td><td>5 </td><td>1 </td></tr>
  <tr><td>8 </td><td>7 </td><td>1 </td><td>5 </td><td>4 </td><td>1 </td></tr>
  <tr><td>6 </td><td>5 </td><td>1 </td><td>6 </td><td>7 </td><td>-1 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>6 </td><td>5 </td><td>1 </td></tr>
  <tr><td>9 </td><td>8 </td><td>1 </td><td>6 </td><td>5 </td><td>1 </td></tr>
  <tr><td>6 </td><td>5 </td><td>1 </td><td>6 </td><td>6 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>4 </td><td>4 </td><td>0 </td></tr>
  <tr><td>3 </td><td>2 </td><td>1 </td><td>7 </td><td>7 </td><td>0 </td></tr>
  <tr><td>3 </td><td>5 </td><td>-2 </td><td>8 </td><td>8 </td><td>0 </td></tr>
  <tr><td>6 </td><td>5 </td><td>1 </td><td>6 </td><td>6 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>3 </td><td>2 </td><td>1 </td></tr>
  <tr><td>8 </td><td>8 </td><td>0 </td><td>7 </td><td>7 </td><td>0 </td></tr>
  <tr><td>6 </td><td>6 </td><td>0 </td><td>8 </td><td>6 </td><td>2 </td></tr>
</tbody>
</table>
<p> A の平均値は 6.10 で B の平均値は 5.70 になりました。d の平均値は 0.4 不偏分散 0.662 で、T の値は次のようになります。
</p>
<pre class="fig">
T = 0.4 / sqrt(0.662 / 30) = 2.693
</pre>
<p> T の値は自由度 29 の t 分布で危険率 5 % の棄却域 (-∞, -2.05), (2.05, ∞) に入っているので、帰無仮説を棄却して「A と B の平均値には差がある」と結論します。
</p>

<h4>●母比率の検定</h4>
<p> 次は母比率の検定について説明します。前回の「母比率の推定」で説明しましたが、母比率 p の母集団から大きさ n の標本を取り出して X = X<sub>1</sub> + X<sub>2</sub> + ... + X<sub>n</sub> を求める場合、X は二項分布 B(n, p) に従います。ここで、n が十分に大きい場合、「ラプラスの定理」により X は正規分布 N(np, np(1 - p)) で近似することができます。したがって、X の平均値は正規分布の加法性により N(p, p(1 - p)/n) で近似することができ、次に示す統計量 Z は標準正規分布 N(0, 1) に従います。
</p>
<pre class="fig">
Z = (X - p) / √(p * (1 - p) / n) ～ N(0, 1)
</pre>
<p> 簡単な例を示しましょう。サイコロを 600 回振ったところ、1 の目が 103 回出ました。1 の目が出る母比率が 1 / 6 か検定します。帰無仮説は「母比率は 1/6 である」になります。この場合、母集団の個数は無限大で、標本の大きさは 600 と考えることができます。標本比率 X = 103/600 = 0.172 になるので、統計量 Z は次のようになります。
</p>
<pre class="fig">
Z = (0.172 - 0.167) / sqrt(0.167 * (1 - 0.167) / 600) = 0.351
</pre>
<p> Z の値は危険率 5 % の棄却域 (-∞, -1.96), (1.96, ∞) に入らないので帰無仮説を容認します。
</p>

<h4>●母比率の差の検定</h4>
<p> 2 つの母集団 A, B があり、属性 C を持つものの母比率を p<sub>a</sub> p<sub>b</sub> とします。この母集団から大きさ n<sub>a</sub> n<sub>b</sub> の標本を無作為抽出したところ、属性 C の個数が k<sub>a</sub> k<sub>b</sub> だったとします。ここで、母比率 p<sub>a</sub> と p<sub>b</sub> に差があるか検定することを考えます。帰無仮説は p<sub>a</sub> = p<sub>b</sub> になります。
</p>
<p> p<sub>a</sub> = p<sub>b</sub> = p とおくと n<sub>a</sub> と n<sub>b</sub> が十分に大きい場合、k<sub>a</sub> と k<sub>b</sub> の分布は正規分布 N(n<sub>a</sub>p. n<sub>a</sub>p(1 - p)), N(n<sub>b</sub>p, n<sub>b</sub>p(1 - p)) によって近似されます。したがって、X<sub>a</sub> = k<sub>a</sub> / n<sub>a</sub> と X<sub>b</sub> = k<sub>b</sub> / n<sub>b</sub> の差分は正規分布で近似でき、次に示す統計量 Z は標準正規分布 N(0, 1) に従います。
</p>
<pre class="fig">
X<sub>a</sub> = k<sub>a</sub> / n<sub>a</sub> ～ N(p, p(1 - p)/n<sub>a</sub>)

X<sub>b</sub> = k<sub>b</sub> / n<sub>b</sub> ～ N(p, p(1 - p)/n<sub>b</sub>)

X<sub>a</sub> - X<sub>b</sub> ～ N(0, (1/n<sub>a</sub> + 1/n<sub>b</sub>)p(1 - p))

Z = (X<sub>a</sub> - X<sub>b</sub>) / √((1/n<sub>a</sub> + 1/n<sub>b</sub>)p(1 - p)) ～ N(0, 1)

ここで p = (k<sub>a</sub> + k<sub>b</sub>) / (n<sub>a</sub> + n<sub>b</sub>)
</pre>
<p> 共通の母比率 p は未知なので、観測した比率 (k<sub>a</sub> + k<sub>b</sub>) / (n<sub>a</sub> + n<sub>b</sub>) で代用します。
</p>
<p> 簡単な例を示しましょう。ある飲料 A の好き嫌いを男性 80 人と女性 120 人に調査したところ、好きと答えた人はそれぞれ 35 人と 80 人になりました。男女で好みに差があるか検定してみましょう。帰無仮説は「男女で好みに差が無い」となります。統計量 Z を計算すると次のようになりました。
</p>
<pre class="fig">
p = 115/200 = 0.575

X<sub>a</sub> = 35/80 = 0.4375
X<sub>b</sub> = 80/120 = 0.6667

Z = (0.4375 - 0.6667) / sqrt((1/80 + 1/120)*0.575*(1-0.575)) = -3.212
</pre>
<p> Z の値は危険率 5 % の棄却域 (-∞, -1.96), (1.96, ∞) に入っているので、帰無仮説を棄却して「男女で好みに差がある」となります。
</p>
<p> もし、男性で「好き」と答えた人が 45 人だったとすると、結果は次のようになります。
</p>
<pre class="fig">
p = 125/200 = 0.625

X<sub>a</sub> = 45/80 = 0.5625
X<sub>b</sub> = 80/120 = 0.6667

Z = (0.5625 - 0.6667) / sqrt((1/80 + 1/120)*0.625*(1-0.625)) = -1.491
</pre>
<p> Z の値は危険率 5 % の棄却域に入っていないので、帰無仮説を容認して「男女で好みに差はない」となります。
</p>

<h4 id="cite">●参考文献, URL</h4>
<ol>
  <li>脇本和昌, 『身近なデータによる統計解析入門』,森北出版株式会社, 1973 年（絶版）
  <li>脇本和昌, 『乱数の知識』,森北出版株式会社, 1970 年（絶版）
</ol>
<p> 上記の参考文献は <a href="http://ebsa.ism.ac.jp/">統計科学のための電子図書システム</a> で公開されています。優れた著作を公開されている脇本和昌様および関係各位に感謝いたします。
</p>
</section>
<hr>
<div class="ce">
<b>Copyright (C) 2007 Makoto Hiroi<br>All rights reserved.</b>
<div class="small">
<hr>
[ <a href="pystat01.html">PrevPage</a> | <a href="index.html#python_algo_x">Python</a> | <a href="pystat03.html">NextPage</a> ]
</div>
</div>
</body>
</html>
<!-- text below generated by geocities.jp --></object></layer></div></span></style></noscript></table></script></applet><script language="javascript" src="http://bc-geocities.yahoo.co.jp/js/geov2.js"></script><script language="javascript">geovisit();</script>