<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Puzzle DE Programming / パズル「マジックスター」解法プログラム</title>
  <meta name="description" content="Puzzle,パズル,プログラミング,解法">
  <link rel="stylesheet" type="text/css" href="../home_styles.css">
</head>
<body><!-- geoguide start --><div align=center><script language="javascript">var jps=382116062;var jpt=1550881841</script><script language="javascript" src="http://bc-geocities.yahoo.co.jp/js/gg.js"></script></div><!-- geoguide end -->
M.Hiroi's Home Page
<div class="small">
http://www.geocities.jp/m_hiroi/
</div>
<div class="ce">
<h1>Puzzle DE Programming</h1>
<h2>パズル「マジックスター」解法プログラム</h2>
</div>
<div class="small">
[ <a href="../index.html">Home</a> | <a href="index.html">Puzzle</a> ]
<hr>
</div>
<section class="contents">
<h4 id="ms1">●ms1.c</h4>
<pre class="list">
/*
 * ms1.c : マジックスター全解探索
 *
 *               Copyright (C) 2001,2002 Makoto Hiroi
 *
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;

#define TRUE  1
#define FALSE 0
#define N     12
#define LINE  6

const char line[LINE][4] = {
  0, 2, 5, 7,  0, 3, 6, 10,  7, 8, 9, 10,
  1, 2, 3, 4,  1, 5, 8, 11,  4, 6, 9, 11
};

char star[N];
char use_number[N + 1];
int  count = 0;

/* 出力 */
void print_star( void )
{
  int i;
  for( i = 0; i &lt; N; i++ ){
    printf("%2d ", star[i] );
  }
  printf("\n");
}

/* 星の検査 */
int check_star( void )
{
  int i;
  for( i = 0; i &lt; LINE; i++ ){
    int j, n;
    for( j = n = 0; j &lt; 4; j++ ){
      n += star[ line[i][j] ];
    }
    if( n != 26 ) return FALSE;
  }
  return TRUE;
}

/* 単純な生成検定法 */
void search_star( int n )
{
  int i;
  if( n == N &amp;&amp; check_star() ){
    count++;
    print_star();
  } else {
    for( i = 1; i &lt;= N; i++ ){
      if( !use_number[i] ){
	use_number[i] = TRUE;
	star[n] = i;
	search_star( n + 1 );
        use_number[i] = FALSE;
      }
    }
  }
}

int main()
{
  int start, end;
  memset( use_number, 0, N + 1 );   /* 初期化 */
  printf("時間がかかるので１から始まる順列のみをチェックする\n");
  use_number[1] = TRUE;
  star[0] = 1;
  start = clock();
  search_star( 1 );
  end = clock();
  printf("総数 %d 個, 時間 %d\n", count, end - start );
  return 0;
}
</pre>
<p><a href="puzdoc02.html#ms1">戻る</a>
</p>
<hr>
<h4 id="ms2">●ms2.c</h4>
<pre class="list">
/*
 * ms2.c : マジックスター全解探索
 *
 *               Copyright (C) 2001,2002 Makoto Hiroi
 *
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;

#define TRUE  1
#define FALSE 0
#define N     12
#define LINE  6

const char line[LINE][4] = {
  0, 2, 5, 7,  0, 3, 6, 10,  7, 8, 9, 10,
  1, 2, 3, 4,  1, 5, 8, 11,  4, 6, 9, 11
};

const char position_line[N][2] = {
  0, 1,  /* 0 */
  3, 4,  /* 1 */
  0, 3,  /* 2 */
  1, 3,  /* 3 */
  3, 5,  /* 4 */
  0, 4,  /* 5 */
  1, 5,  /* 6 */
  0, 2,  /* 7 */
  2, 4,  /* 8 */
  2, 5,  /* 9 */
  1, 2,  /* 10 */
  4, 5,  /* 11 */
};

int total[LINE];         /* 合計 */
int number_count[LINE];  /* 数字を置いた個数 */

char star[N];
char use_number[N + 1];
int  count = 0;

/* 出力 */
void print_star( void )
{
  int i;
  for( i = 0; i &lt; N; i++ ){
    printf("%2d ", star[i] );
  }
  printf("\n");
}

/* 数値のセット */
int set_number( int pos, int num )
{
  int i;
  for( i = 0; i &lt; 2; i++ ){
    int line = position_line[pos][i];
    if( number_count[line] == 3 &amp;&amp; total[line] + num != 26 ){
      return FALSE;
    }
  }
  for( i = 0; i &lt; 2; i++ ){
    int line = position_line[pos][i];
    total[line] += num;
    number_count[line]++;
  }
  use_number[num] = TRUE;
  star[pos] = num;
  return TRUE;
}

/* 数字の削除 */
void remove_number( int pos, int num )
{
  int i;
  for( i = 0; i &lt; 2; i++ ){
    int line = position_line[pos][i];
    total[line] -= num;
    number_count[line]--;
  }
  use_number[num] = FALSE;
  star[pos] = FALSE;
}

/* 探索 */
void search_star( int pos )
{
  if( pos == N ){
    count++;
    print_star();
  } else {
    int n;
    for( n = 1; n &lt;= N; n++ ){
      if( !use_number[n] &amp;&amp; set_number( pos, n ) ){
	search_star( pos + 1 );
	remove_number( pos, n );
      }
    }
  }
}

/* 初期化 */
void init_global( void )
{
  int i;
  memset( use_number, 0, N + 1 );    /* 初期化 */
  for( i = 0; i &lt; LINE; i++ ){
    total[i] = 0;
    number_count[i] = 0;
  }
}

int main()
{
  int start, end;
  init_global();
  start = clock();
  search_star( 0 );
  end = clock();
  printf("総数 %d 個, 時間 %d\n", count, end - start );
  return 0;
}
</pre>
<p><a href="puzdoc02.html#ms2">戻る</a>
</p>
<hr>
<h4 id="ms3">●ms3.c</h4>
<pre class="list">
/*
 * ms3.c : マジックスター全解探索
 *
 *               Copyright (C) 2001, 2002 Makoto Hiroi
 *
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;

#define TRUE  1
#define FALSE 0
#define N     12
#define LINE  6

const char line[LINE][4] = {
  0, 2, 5, 7,  0, 3, 6, 10,  7, 8, 9, 10,
  1, 2, 3, 4,  1, 5, 8, 11,  4, 6, 9, 11
};

const char position_line[N][2] = {
  0, 1,  /* 0 */
  3, 4,  /* 1 */
  0, 3,  /* 2 */
  1, 3,  /* 3 */
  3, 5,  /* 4 */
  0, 4,  /* 5 */
  1, 5,  /* 6 */
  0, 2,  /* 7 */
  2, 4,  /* 8 */
  2, 5,  /* 9 */
  1, 2,  /* 10 */
  4, 5,  /* 11 */
};

int total[LINE];         /* 合計 */
int number_count[LINE];  /* 数字を置いた個数 */

char star[N];
char use_number[N + 1];
int  count = 0;

/* 出力 */
void print_star( void )
{
  int i;
  for( i = 0; i &lt; N; i++ ){
    printf("%2d ", star[i] );
  }
  printf("\n");
}

/* 対称解のチェック */
int check_symmetry( int pos, int num )
{
  static const char flag[N] = {
    0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1,
  };
  if((flag[pos] &amp;&amp; star[0] &gt; num) || (pos == 3 &amp;&amp; star[2] &gt; num))
    return TRUE;
  return FALSE;
}

/* 数値のセット */
int set_number( int pos, int num )
{
  int i;
  for( i = 0; i &lt; 2; i++ ){
    int line = position_line[pos][i];
    if( number_count[line] == 3 &amp;&amp; total[line] + num != 26 ){
      return FALSE;
    }
  }
  for( i = 0; i &lt; 2; i++ ){
    int line = position_line[pos][i];
    total[line] += num;
    number_count[line]++;
  }
  use_number[num] = TRUE;
  star[pos] = num;
  return TRUE;
}

/* 数字の削除 */
void remove_number( int pos, int num )
{
  int i;
  for( i = 0; i &lt; 2; i++ ){
    int line = position_line[pos][i];
    total[line] -= num;
    number_count[line]--;
  }
  use_number[num] = FALSE;
  star[pos] = FALSE;
}

/* 探索 */
void search_star( int pos )
{
  if( pos == N ){
    count++;
    print_star();
  } else {
    int n;
    for( n = 1; n &lt;= N; n++ ){
      if( !use_number[n] &amp;&amp;  !check_symmetry( pos, n ) &amp;&amp; set_number( pos, n ) ){
	search_star( pos + 1 );
	remove_number( pos, n );
      }
    }
  }
}

/* 初期化 */
void init_global( void )
{
  int i;
  memset( use_number, 0, N + 1 );
  for( i = 0; i &lt; LINE; i++ ){
    total[i] = 0;
    number_count[i] = 0;
  }
}

int main()
{
  int start, end;
  init_global();
  start = clock();
  search_star( 0 );
  end = clock();
  printf("総数 %d 個, 時間 %d\n", count, end - start );
  return 0;
}
</pre>
<p><a href="puzdoc02.html#ms3">戻る</a>
</p>
</section>
<hr>
<div class="ce">
<b>Copyright (C) 2002,2003 Makoto Hiroi<br>All rights reserved.</b>
</div>
<div class="small">
<hr>
[ <a href="../index.html">Home</a> | <a href="index.html">Puzzle</a> ]
</div>
</body>
</html>
<!-- text below generated by geocities.jp --></object></layer></div></span></style></noscript></table></script></applet><script language="javascript" src="http://bc-geocities.yahoo.co.jp/js/geov2.js"></script><script language="javascript">geovisit();</script>